{% extends "base.html" %} {% block content %}

<div class="container py-5" id="result-section">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card shadow">
        <div class="card-header text-center bg-dark text-white">
          <h4><i class="fas fa-graduation-cap"></i> ADETOLA PRIVATE SCHOOL</h4>
        </div>
        <div class="card-body py-4">
          {% if messages %} {% for message in messages %}
          <div
            class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show"
            role="alert"
          >
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Close"
            ></button>
          </div>
          {% endfor %} {% endif %}

          <div>
            <p><strong>Full Name:</strong> {{ student.name }}</p>
            <p><strong>Roll ID:</strong> {{ student.roll_id }}</p>
            <p>
              <strong>Class:</strong> {{ student.student_class.class_name }}
            </p>
            <p>
              <strong>Section : </strong>
              {{ student.student_class.section }}
            </p>

            {% if results %}
            <table class="table table-bordered mt-4 text-center">
              <thead class="table-secondary">
                <tr>
                  <th>#</th>
                  <th>Subject</th>
                  <th>Test</th>
                  <th>Exam</th>
                  <th>Total</th>
                  <th>Grade</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for result in results %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ result.subject.subject_name }}</td>
                  <td>{{ result.test_marks }}</td>
                  <td>{{ result.exam_marks }}</td>
                  <td><strong>{{ result.total_marks }}</strong></td>
                  <td>{{ result.grade }}</td>
                  <td>
                    {% if result.status == "Pass" %}
                    <span class="badge bg-success">Pass</span>
                    {% else %}
                    <span class="badge bg-danger">Fail</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
                <tr>
                  <th colspan="2">Total Marks</th>
                  <td colspan="2"></td>
                  <td>
                    <b>{{ total_marks }}</b> out of <b>{{ max_total }}</b>
                  </td>
                  <td colspan="2"></td>
                </tr>
                <tr>
                  <th colspan="2">Percentage</th>
                  <td colspan="5"><b>{{ percentage }}%</b></td>
                </tr>
                <tr>
                  <td colspan="7">
                    <i
                      class="fa fa-print fa-2x"
                      style="cursor: pointer"
                      onclick="printResult()"
                    ></i>
                  </td>
                </tr>
              </tbody>
            </table>
            {% else %}
            <div class="alert alert-info" role="alert">
              Your result is not available yet. Please check back later.
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function printResult() {
      var printContents = document.getElementById("result-section").innerHTML;
      var win = window.open("", "_blank", "height=700,width=900");
      win.document.write("<html><head><title>Print Result</title>");
      win.document.write(
        '<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"/>'
      );
      win.document.write(
        "<style>@media print{body {-webkit-print-color-adjust : exact;}}</style>"
      );
      win.document.write("</head><body>");
      win.document.write(printContents);
      win.document.write("</body></html>");
      win.document.close();
      win.print();
    }
  </script>
</div>

{% endblock %}
